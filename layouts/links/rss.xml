{{- $pctx := . -}}
{{- if .IsHome }}{{ $pctx = .Site }}{{ end -}}
{{- $pages := slice -}}
{{- if or $.IsHome $.IsSection }}
  {{- $pages = $pctx.RegularPages -}}
{{- else }}
  {{- $pages = $pctx.Pages -}}
{{- end }}
{{- $pages = where $pages "Section" "links" -}}
{{- $limit := .Site.Config.Services.RSS.Limit | default 15 -}}
{{- if ge $limit 1 }}{{ $pages = first $limit $pages }}{{ end }}

{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<rss version="2.0"
     xmlns:atom="http://www.w3.org/2005/Atom"
     xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>{{ .Site.Title }} â€” Links</title>
    <link>{{ .Permalink }}</link>
    <description>Recent link posts from {{ .Site.Title }}</description>
    <language>{{ .Site.LanguageCode | default "en-us" }}</language>
    <generator>Hugo -- gohugo.io</generator>
    {{ with .OutputFormats.Get "RSS" }}
      <atom:link href="{{ .Permalink }}" rel="self" type="{{ .MediaType.Type }}" />
    {{ end }}

    {{ range $pages }}
    <item>
      <title>{{ .Title }}</title>

      {{ if .Params.external_url }}
        <link>{{ .Params.external_url }}</link>
      {{ else }}
        <link>{{ .Permalink }}</link>
      {{ end }}

      <guid isPermaLink="false">{{ .Permalink }}</guid>
      <pubDate>{{ .Date.Format "Mon, 02 Jan 2006 15:04:05 -0700" }}</pubDate>

      <description>{{ .Params.description | htmlEscape }}</description>

      <content:encoded><![CDATA[
        {{ if .Params.description }}<p>{{ .Params.description }}</p>{{ end }}
        {{ if .Params.image }}<p><img src="{{ .Params.image }}" alt="{{ .Title }}" /></p>{{ end }}
        {{ .Content }}
        <hr />
        <p><a href="mailto:you@example.com?subject={{ .Title | urlquery }}">Thoughts? Email me</a></p>
      ]]></content:encoded>
    </item>
    {{ end }}
  </channel>
</rss>